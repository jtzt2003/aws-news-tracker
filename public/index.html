<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Updates Tracker</title>
    <meta name="description" content="Real-time AWS updates announcement tracker with AI-powered summaries">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Configuration
        const API_BASE_URL = window.location.origin;
        const AUTO_REFRESH_INTERVAL = 300000; // 5 minutes

        // AWS Service Categories
        const CATEGORIES = {
            COMPUTE: { name: 'Compute', color: 'bg-orange-500', icon: '‚ö°' },
            STORAGE: { name: 'Storage', color: 'bg-green-500', icon: 'üíæ' },
            DATABASE: { name: 'Database', color: 'bg-blue-500', icon: 'üóÑÔ∏è' },
            AI_ML: { name: 'AI/ML', color: 'bg-purple-500', icon: 'ü§ñ' },
            ANALYTICS: { name: 'Analytics', color: 'bg-yellow-500', icon: 'üìä' },
            SECURITY: { name: 'Security', color: 'bg-red-500', icon: 'üîí' },
            NETWORKING: { name: 'Networking', color: 'bg-cyan-500', icon: 'üåê' },
            DEVTOOLS: { name: 'Developer Tools', color: 'bg-indigo-500', icon: 'üõ†Ô∏è' },
            CONTAINERS: { name: 'Containers', color: 'bg-teal-500', icon: 'üì¶' },
            SERVERLESS: { name: 'Serverless', color: 'bg-pink-500', icon: '‚öôÔ∏è' },
            OTHER: { name: 'Other', color: 'bg-gray-500', icon: 'üìå' }
        };

        // Notification Component
        function Notification({ message, type = 'info', onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 5000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            return (
                <div className={`fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-2xl z-50 slide-in flex items-center gap-3`}>
                    <span>{message}</span>
                    <button onClick={onClose} className="text-xl leading-none">&times;</button>
                </div>
            );
        }

        // Main App Component
        function AnnouncementTracker() {
            const [announcements, setAnnouncements] = useState([]);
            const [stats, setStats] = useState(null);
            const [selectedCategory, setSelectedCategory] = useState('ALL');
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedAnnouncement, setSelectedAnnouncement] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [notification, setNotification] = useState(null);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [dateFilter, setDateFilter] = useState('ALL'); // NEW: Date filter state

            // Load initial data
            useEffect(() => {
                loadData();
            }, []);

            // Auto-refresh
            useEffect(() => {
                const interval = setInterval(() => {
                    loadData(true);
                }, AUTO_REFRESH_INTERVAL);

                return () => clearInterval(interval);
            }, []);

            // Request notification permission
            useEffect(() => {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }, []);

            // Load data from API
            const loadData = async (silent = false) => {
                try {
                    if (!silent) setIsLoading(true);
                    
                    const [announcementsRes, statsRes] = await Promise.all([
                        fetch(`${API_BASE_URL}/api/announcements`),
                        fetch(`${API_BASE_URL}/api/stats`)
                    ]);

                    if (!announcementsRes.ok || !statsRes.ok) {
                        throw new Error('Failed to fetch data');
                    }

                    const announcementsData = await announcementsRes.json();
                    const statsData = await statsRes.json();

                    setAnnouncements(announcementsData.announcements);
                    setStats(statsData);
                    setLastUpdate(new Date(announcementsData.lastUpdate));

                    if (silent && announcementsData.announcements.some(a => a.isNew)) {
                        showNotification('New announcements available!', 'success');
                        
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('AWS News Update', {
                                body: 'New announcements are available',
                                icon: '/favicon.ico'
                            });
                        }
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    showNotification('Failed to load announcements', 'error');
                } finally {
                    setIsLoading(false);
                }
            };

            // Show notification
            const showNotification = (message, type = 'info') => {
                setNotification({ message, type });
            };

            // Filter announcements
            const filteredAnnouncements = announcements.filter(ann => {
                const matchesCategory = selectedCategory === 'ALL' || ann.category === selectedCategory;
                const matchesSearch = ann.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                     ann.summary.toLowerCase().includes(searchQuery.toLowerCase());
                
                // NEW: Date filtering
                let matchesDate = true;
                if (dateFilter !== 'ALL') {
                    const announcementDate = new Date(ann.timestamp);
                    const now = new Date();
                    const daysAgo = parseInt(dateFilter);
                    const cutoffDate = new Date(now.getTime() - (daysAgo * 24 * 60 * 60 * 1000));
                    matchesDate = announcementDate >= cutoffDate;
                }
                
                return matchesCategory && matchesSearch && matchesDate;
            });

            // Get category stats
            const categoryStats = stats ? Object.keys(CATEGORIES).map(key => {
                const count = stats.categories[key] || 0;
                return { key, count, ...CATEGORIES[key] };
            }).filter(stat => stat.count > 0) : [];

            if (isLoading) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-center">
                            <div className="text-6xl mb-4 animate-spin">‚öôÔ∏è</div>
                            <div className="text-2xl text-gray-300">Loading announcements...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container mx-auto px-4 py-8 max-w-7xl">
                    {/* Notification */}
                    {notification && (
                        <Notification
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotification(null)}
                        />
                    )}

                    {/* Header */}
                    <div className="mb-8">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h1 className="text-5xl font-bold bg-gradient-to-r from-orange-400 via-pink-500 to-purple-500 bg-clip-text text-transparent">
                                    AWS Updates Tracker
                                </h1>
                                <p className="text-xl text-gray-300 mt-2">Live Announcement Tracker</p>
                            </div>
                            <div className="text-right">
                                <button
                                    onClick={() => loadData()}
                                    className="px-6 py-3 bg-purple-500 hover:bg-purple-600 rounded-lg font-medium transition-all mb-2"
                                >
                                    üîÑ Refresh
                                </button>
                                <div className="flex items-center gap-2 text-sm text-gray-400">
                                    <span className="pulse-slow">‚óè</span>
                                    <span>Updated: {lastUpdate?.toLocaleTimeString() || 'Never'}</span>
                                </div>
                                <div className="text-2xl font-bold text-orange-400 mt-1">
                                    {stats?.total || 0} Announcements
                                </div>
                                {stats?.newCount > 0 && (
                                    <div className="text-sm text-green-400 font-semibold">
                                        {stats.newCount} new in last hour
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Search Bar */}
                        <div className="relative">
                            <input
                                type="text"
                                placeholder="Search announcements..."
                                className="w-full px-6 py-4 bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50 text-white placeholder-gray-400"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                            />
                            <span className="absolute right-4 top-4 text-gray-400 text-xl">üîç</span>
                        </div>
                        
                        {/* Date Filter Dropdown - NEW */}
                        <div className="mt-4">
                            <label className="block text-sm text-gray-300 mb-2">üìÖ Time Range</label>
                            <select
                                value={dateFilter}
                                onChange={(e) => setDateFilter(e.target.value)}
                                className="px-4 py-2 bg-white/10 backdrop-blur-lg rounded-lg border border-white/20 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50 text-white cursor-pointer"
                            >
                                <option value="ALL" className="bg-slate-800">All Time</option>
                                <option value="1" className="bg-slate-800">Last 24 Hours</option>
                                <option value="3" className="bg-slate-800">Last 3 Days</option>
                                <option value="7" className="bg-slate-800">Last 7 Days</option>
                                <option value="14" className="bg-slate-800">Last 14 Days</option>
                                <option value="30" className="bg-slate-800">Last 30 Days</option>
                            </select>
                            {dateFilter !== 'ALL' && (
                                <span className="ml-3 text-sm text-gray-400">
                                    ({filteredAnnouncements.length} announcements)
                                </span>
                            )}
                        </div>
                    </div>

                    {/* Category Filter Pills */}
                    <div className="mb-8 flex flex-wrap gap-3">
                        <button
                            onClick={() => setSelectedCategory('ALL')}
                            className={`px-6 py-2 rounded-full font-medium transition-all ${
                                selectedCategory === 'ALL'
                                    ? 'bg-white text-purple-900 shadow-lg scale-105'
                                    : 'bg-white/10 hover:bg-white/20 backdrop-blur-lg border border-white/20'
                            }`}
                        >
                            All ({stats?.total || 0})
                        </button>
                        {categoryStats.map(stat => (
                            <button
                                key={stat.key}
                                onClick={() => setSelectedCategory(stat.key)}
                                className={`px-6 py-2 rounded-full font-medium transition-all flex items-center gap-2 ${
                                    selectedCategory === stat.key
                                        ? 'bg-white text-purple-900 shadow-lg scale-105'
                                        : 'bg-white/10 hover:bg-white/20 backdrop-blur-lg border border-white/20'
                                }`}
                            >
                                <span>{stat.icon}</span>
                                <span>{stat.name} ({stat.count})</span>
                            </button>
                        ))}
                    </div>

                    {/* Announcements Grid */}
                    <div className="grid gap-6 lg:grid-cols-2">
                        {filteredAnnouncements.map(announcement => {
                            const category = CATEGORIES[announcement.category];
                            return (
                                <div
                                    key={announcement.id}
                                    className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 hover:border-purple-500/50 transition-all hover:shadow-2xl hover:shadow-purple-500/20 cursor-pointer"
                                    onClick={() => setSelectedAnnouncement(announcement)}
                                >
                                    {/* Category Badge */}
                                    <div className="flex items-center justify-between mb-4">
                                        <span className={`${category.color} px-4 py-1 rounded-full text-sm font-medium flex items-center gap-2`}>
                                            <span>{category.icon}</span>
                                            {category.name}
                                        </span>
                                        {announcement.isNew && (
                                            <span className="bg-green-500 px-3 py-1 rounded-full text-xs font-bold pulse-slow">
                                                NEW
                                            </span>
                                        )}
                                    </div>

                                    {/* Title */}
                                    <h3 className="text-xl font-bold mb-3 text-white">
                                        {announcement.title}
                                    </h3>

                                    {/* Summary */}
                                    <p className="text-gray-300 mb-4 line-clamp-3">
                                        {announcement.summary}
                                    </p>

                                    {/* Footer */}
                                    <div className="flex items-center justify-between pt-4 border-t border-white/10">
                                        <div className="text-sm text-gray-400">
                                            <div>{new Date(announcement.timestamp).toLocaleString()}</div>
                                            <div className="text-xs">{announcement.source}</div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    window.open(announcement.link, '_blank');
                                                }}
                                                className="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-lg font-medium transition-all"
                                            >
                                                üîó View
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* No results */}
                    {filteredAnnouncements.length === 0 && (
                        <div className="text-center py-16">
                            <div className="text-6xl mb-4">üîç</div>
                            <p className="text-xl text-gray-400">No announcements found</p>
                        </div>
                    )}

                    {/* Detail Modal */}
                    {selectedAnnouncement && (
                        <div
                            className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50"
                            onClick={() => setSelectedAnnouncement(null)}
                        >
                            <div
                                className="bg-gradient-to-br from-slate-800 to-purple-900 rounded-2xl p-8 max-w-3xl w-full max-h-[80vh] overflow-y-auto border border-white/20"
                                onClick={(e) => e.stopPropagation()}
                            >
                                {/* Close Button */}
                                <button
                                    onClick={() => setSelectedAnnouncement(null)}
                                    className="float-right text-gray-400 hover:text-white text-3xl leading-none"
                                >
                                    √ó
                                </button>

                                {/* Category */}
                                <div className="mb-4">
                                    <span className={`${CATEGORIES[selectedAnnouncement.category].color} px-4 py-2 rounded-full text-sm font-medium inline-flex items-center gap-2`}>
                                        <span>{CATEGORIES[selectedAnnouncement.category].icon}</span>
                                        {CATEGORIES[selectedAnnouncement.category].name}
                                    </span>
                                </div>

                                {/* Title */}
                                <h2 className="text-3xl font-bold mb-4 text-white">
                                    {selectedAnnouncement.title}
                                </h2>

                                {/* Metadata */}
                                <div className="text-sm text-gray-400 mb-6 flex gap-4">
                                    <span>üìÖ {new Date(selectedAnnouncement.timestamp).toLocaleString()}</span>
                                    <span>üì∞ {selectedAnnouncement.source}</span>
                                </div>

                                {/* Summary */}
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2 text-purple-300">AI Summary</h3>
                                    <p className="text-gray-300">{selectedAnnouncement.summary}</p>
                                </div>

                                {/* Full Text */}
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2 text-purple-300">Details</h3>
                                    <p className="text-gray-300 leading-relaxed">{selectedAnnouncement.fullText}</p>
                                </div>

                                {/* Actions */}
                                <div className="flex gap-4">
                                    <button
                                        onClick={() => window.open(selectedAnnouncement.link, '_blank')}
                                        className="flex-1 py-3 bg-blue-500 hover:bg-blue-600 rounded-lg font-medium transition-all"
                                    >
                                        üîó Read Full Article
                                    </button>
                                    <button
                                        onClick={() => {
                                            navigator.clipboard.writeText(
                                                `${selectedAnnouncement.title}\n\n${selectedAnnouncement.fullText}`
                                            );
                                            showNotification('Copied to clipboard!', 'success');
                                        }}
                                        className="flex-1 py-3 bg-green-500 hover:bg-green-600 rounded-lg font-medium transition-all"
                                    >
                                        üìã Copy Text
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* System Info */}
                    <div className="mt-8 bg-blue-500/20 border border-blue-500/50 rounded-2xl p-6">
                        <h3 className="text-xl font-bold mb-3 flex items-center gap-2">
                            <span>‚ÑπÔ∏è</span>
                            System Status
                        </h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <div className="bg-white/10 rounded-lg p-4">
                                <div className="text-2xl font-bold text-purple-400">{stats?.total || 0}</div>
                                <div className="text-sm text-gray-400">Total</div>
                            </div>
                            <div className="bg-white/10 rounded-lg p-4">
                                <div className="text-2xl font-bold text-green-400">{stats?.newCount || 0}</div>
                                <div className="text-sm text-gray-400">New</div>
                            </div>
                            <div className="bg-white/10 rounded-lg p-4">
                                <div className="text-2xl font-bold text-orange-400">
                                    {Object.keys(stats?.categories || {}).length}
                                </div>
                                <div className="text-sm text-gray-400">Categories</div>
                            </div>
                            <div className="bg-white/10 rounded-lg p-4">
                                <div className="text-2xl font-bold text-cyan-400">
                                    {Object.keys(stats?.sources || {}).length}
                                </div>
                                <div className="text-sm text-gray-400">Sources</div>
                            </div>
                        </div>
                        <div className="mt-4 text-center text-sm text-gray-400">
                            <p>Hosted on Vercel ‚Ä¢ Updates every 5 minutes</p>
                            <p className="mt-1">Powered by Claude AI</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AnnouncementTracker />, document.getElementById('root'));
    </script>
</body>
</html>